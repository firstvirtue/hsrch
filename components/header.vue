<template lang="html">
  <header class="header">
    <div class="l-header">
      <a href="/">
        <div class="logo">
          <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 434.9 219">
            <defs>
          </defs>
          <path class="cls-1" d="M204.4 90.3l.3-.2v-.4l-.3.6z"/>
          <path class="cls-2" d="M189.5 104.1l.3-1.3c2.2-.1 3.1-1.8 3.9-3.5h-1.3c-.6.8-.3 1.3.6.9a10.1 10.1 0 0 0-5 3.5c.5.2.9.6 1.5.4zM187.3 104.5l.7-.9-.1-.1-.6 1z"/>
          <path class="cls-1" d="M104.3 108.1a18.7 18.7 0 0 0 3-10.2 18.4 18.4 0 0 0-7.6-15.4h8a1.1 1.1 0 0 0 1.1-1v-4.7a1.1 1.1 0 0 0-1.1-1H90.5v-3.7c0-2.4-1.5-3.7-3.9-3.7h-1.3c-1.7-.2-4-.5-5.3 1.1s-.5 4.4 0 6.4H62c-1.1 0-1.1 0-1.1 5.7a1.2 1.2 0 0 0 1.1 1h8.1A20 20 0 0 0 62.2 99c.2 7.9 4.3 13.7 12.2 17.4a23 23 0 0 0 10.4 2.3c8.6 0 15.2-3.6 19.5-10.6zm-29.9-2.2a14.7 14.7 0 0 1-2.1-7.8 15.7 15.7 0 0 1 2.2-7.9 11.5 11.5 0 0 1 5-5 13.9 13.9 0 0 1 5.6-1.3 10.9 10.9 0 0 1 10.1 6 15 15 0 0 1 1.9 7.8c0 5.8-1.9 9.9-6.1 12.5a11.5 11.5 0 0 1-6.2 1.8 11.7 11.7 0 0 1-10.4-6.1zM118 80.3v50.3a1.1 1.1 0 0 0 1 1h2.9a1.2 1.2 0 0 0 .8-.4c3.6-4.3 5.4-10.7 5.4-19.1v-18h9.4a.9.9 0 0 0 1-1v-4.7a.9.9 0 0 0-1-1h-9.4v-14c0-5-3-5.7-4.8-5.7s-3.8.7-4.7 2.2-1 4.8-.8 7.4c.1 1 .2 2.1.2 3zm43.2 19.5zm43 12.6h-9.3v-16c0-4.9-3-5.7-4.8-5.7h-1.2c-2-.1-3.8-.1-4.5 1.9a9.1 9.1 0 0 0-.3 2.7c0 1.4.2 2.9.3 4.3a29.7 29.7 0 0 1 .3 4.2v64.7a1.1 1.1 0 0 0 1.1 1.1h1.9a1.2 1.2 0 0 0 .8-.4c4.2-5 6.4-13.9 6.4-26.6v-23.5h9.3a1.1 1.1 0 0 0 1.1-1.1v-4.6a1.1 1.1 0 0 0-1.1-1zm-46.2 4.8l-1.8-2.8c.7-1.7 2.9-7.6 2.9-7.6.6-1.6 1.1-2.9 1.5-3.8a5.2 5.2 0 0 0 .6-3.2 3.3 3.3 0 0 0-3-2.9l-1.2-.2c-1.7-.4-3.8-.9-5.2.1a4.9 4.9 0 0 0-1.6 3.3 2.9 2.9 0 0 0-.2.9 95.6 95.6 0 0 1-5.7 14.7 80.6 80.6 0 0 1-8.8 14.1c-1.8 2.3-3.7 4.3-5.6 6.4s-3 2.7-4.6 4.1-7.2 3.3-10.9 4.1a56.3 56.3 0 0 1-12.3 1c-9.1-.1-14-2.9-14.9-8.3v-7.4a5.7 5.7 0 0 0-1.2-4.3 3.7 3.7 0 0 0-2.9-1.2h-1a3.9 3.9 0 0 0-3.9 1.4c-1.7 2.2-1.4 4.6-1.1 6.7v.5a20.6 20.6 0 0 1 .1 4.3c0 .7-.1 1.5-.1 2.1s0 .3.1.4a16.2 16.2 0 0 0 5.2 7.3c4.9 3.8 11.5 5.8 19.7 5.8a53 53 0 0 0 33.1-11.4 65.7 65.7 0 0 0 8.5-8.2c1.3-1.5 2.7-3.1 3.9-4.8s3.9-4.7 3.6-5.1l.9 1.2c7 9.4 14.6 16.7 22.6 21.7a1.2 1.2 0 0 0 1.4-.3l2.2-2.9a.9.9 0 0 0 0-1.3c-9.7-10.3-16.4-18.4-20.3-24.4zM250.8 107.1a1.2 1.2 0 0 0 .7-1v-3.3a.9.9 0 0 0-.4-.8.8.8 0 0 0-.8-.2c-11 2.6-20.4 3.8-28.1 3.6s-9.2-4.7-9.2-6.2v-5.9h28.3a1 1 0 0 0 1-1V73.5a1 1 0 0 0-1-1h-38.8a1 1 0 0 0-1.1 1v4.4a1.1 1.1 0 0 0 1.1 1.1h30.1v7.8h-16.9c-4.5-.1-12.1-.3-12.6 5-.1 1.7 0 3.7 0 5.9l.2 2.4c.1 4.1 1.3 7.2 3.7 9.2s6.8 3.4 12.9 3.6c9 .2 19.4-1.8 30.9-5.8zm21.7-20.4h-8.9V73.5c0-4.7-2.9-5.4-4.6-5.4h-.7c-1.8-.1-3.4-.1-4.3 2.1l-.3 1a11.9 11.9 0 0 0 0 4.6 19.5 19.5 0 0 1 .2 2.3v41.3l-4-1.4a47.9 47.9 0 0 0-12-1.8c-8.3 0-14.7 2.3-19.1 6.8s-4.5 6.5-4.4 10.1a13.6 13.6 0 0 0 4.4 9.5 21.7 21.7 0 0 0 8.6 5 36.4 36.4 0 0 0 11.1 1.8c9.4 0 16.4-2.7 21-7.9 2.6-3 3.9-6.2 3.7-9.6s-2.4-8.4-6.7-11h1.1a1 1 0 0 0 .8-.4c3.4-4.1 5.2-10.2 5.2-18.2v-9.1h8.9a1.1 1.1 0 0 0 1-1v-4.4a1 1 0 0 0-1-1.1zM247 141.3a18.6 18.6 0 0 1-8.4 1.5c-5.8 0-10.1-1.6-12.6-4.6a8.1 8.1 0 0 1-2-5.2c0-4.6 2.7-7.6 8-9.2a22.4 22.4 0 0 1 6.8-1c5.9 0 10.3 1.6 12.9 4.9a8.3 8.3 0 0 1 1.8 5c0 3.7-2.1 6.6-6.5 8.6zM400.8 92.4c-1.6-.5-3.1-.5-4.1.3s-2.3 6.9-2.2 10.3c0 .6.1 1.1.1 1.6v35.5h-22v-5a18.6 18.6 0 0 0 11.3-7.9 16 16 0 0 0 2.9-9.3 14.9 14.9 0 0 0-6.2-12.6h7.9a1 1 0 0 0 1-1.1V100a1 1 0 0 0-1-1.1h-15.9v-2.7a3.4 3.4 0 0 0-3.7-3.6h-1.1c-1.4-.2-3.2-.4-4.5 1s-.7 3.6-.5 5.4h-18a1 1 0 0 0-1 1.1v4.2a1 1 0 0 0 1 1.1h8.2c-4.3 3.7-6.5 8.1-6.5 13 0 7.1 3.6 12.3 10.6 15.5a20.8 20.8 0 0 0 6 1.8v4.5h-22.6l-.7.2h-20.6V122c.2-4-2-5.3-3.8-5.8s-3.6-.6-4.9.4a3.3 3.3 0 0 0-1.2 2.5c-.2 4.5 0 9.2.1 13.8.1 2.4.1 4.9.2 7.4h-10.3v-15.6c.5-4.7-2.1-5.7-3.7-5.9h-2.3c-3.9 0-4 3.1-4 5.2a24.2 24.2 0 0 0 .2 3.8c.1 1 .2 2 .2 3v9.5h-17.8a1.1 1.1 0 0 0-1 1v4.2a1.1 1.1 0 0 0 1 1.1h122.7v18.3a1 1 0 0 0 1 1h1.8a.9.9 0 0 0 .8-.4c4-4.7 5.9-12.8 5.9-24.8v-43c0-1.9-.3-4.2-3.3-5.3zm-34.2 37a9.6 9.6 0 0 1-8.8-5.1 11.3 11.3 0 0 1-1.7-6.3c0-5.3 2-8.8 6.1-10.7a12 12 0 0 1 4.8-1.1 9.3 9.3 0 0 1 8.6 4.9 13.5 13.5 0 0 1 1.7 6.4c0 4.8-1.8 8.2-5.5 10.4a9.5 9.5 0 0 1-5.2 1.5zm-83.5-23.9h41v15.4a32.8 32.8 0 0 1-2.8 12.3.9.9 0 0 0 .1 1.1l.8 1.1a.9.9 0 0 0 1.3.4 17.4 17.4 0 0 0 6.6-5.5c2.1-3.1 3.1-7.7 3.1-13.6v-16.3a.9.9 0 0 0-1-1h-49.1a1 1 0 0 0-1.1 1v4.1a1.1 1.1 0 0 0 1.1 1z"/>
          <path class="ci-line" d="M380.4 157.1c-4.6.6-8.8 2.6-13.1 4.2l.5-.3c-6.7 3.9-13.3 6.2-20.6 8.4-11.9 3.4-26.3 4.6-38.4 7.1-24.1 4.8-45.7 8-70.2 9.3-28.6 1.5-62.1 2.6-90.3-2.5a195.8 195.8 0 0 1-40-11.4C86.8 163.1 66 151.6 53.2 132c-6.5-10.1-9.7-20.6-9.2-31.7.5-8.1 3.8-16.5 6.4-22.4 4.1-9.5 8.8-17 14.5-23.1-6.6 6.6-10.3 12.6-14.5 22.3-2.8 6.6 0-5.4 2.3-9.8.9-1.9 3.9-3.7 4.9-5.3 2.7-3.4 4.9-7 8.3-10.3 1.3-1.6 2.1-.2 2.7-.8 4.8-4.2 8.5-8.1 12.5-9.3 9-2.6 18.3-3.8 27.7-2.1s16 6.1 22.5 12.8c4.2 4.3 8 9.7 9.3 15.5.6 2.7 0 6.1 2.2 8.1s7.6 1.1 10-1.4a15.6 15.6 0 0 0 3-4.4h.1c4.5-3.7.9-5.3 4.7-9.9-2.2 3.2-2.9-6.9 2.1-8.3s6.8-7.7 12.9-9.6c1.3-.4 2.5-1.1 4-1.7 8.2-1.2 14.9.3 22.4 5.2s11.2 5.6 14.9 13.8c5.4-3.2-3-14.4-5.8-17.3-5.5-6-11.5-8.1-19.5-9.1a48.2 48.2 0 0 0-16.1.5c-10.8 2.9-18.8 8.4-26.8 18-2.4 2.9-3.1 9-2.8 13.8a1.8 1.8 0 0 1-.7.9c-1.9-1.7-2.1-4.1-3.2-6.3a70.8 70.8 0 0 0-5.3-8.8c-2.5-4.1-6.6-9-11-11.3s-8.5-6-13.3-7.6c-6.3-2.2-13.2-2.4-19.8-2-12.8 1-26.9 5-37.3 13.5-30.5 24.8-38.2 73.9-10.5 99.8 16 14.9 42.3 31.3 63.5 38.4a221.2 221.2 0 0 0 84.2 11.2c23.1-1.6 38-1.9 68.3-6.1 36.8-5.1 71.9-9.8 104.8-22.7-8.2 2.9-16.3 6.2-24.7 8.5 13-6.1 26.9-10.6 40.5-15.5-1.1.4-2.4.6-3.6.9l4.6-1.4zM219.7 53.7l-.4-.4z"/>
        </svg>
      </div>
    </a>
    <nav class="gnb">
      <ul>
        <li>
          <a href="/intro">환영합니다</a>
        </li>
        <li>
          <!-- <nuxt-link to="list">설교와 찬양</nuxt-link> -->
          <a href="/worship">설교와 찬양</a>
        </li>
        <li>
          <a href="/community">커뮤니티</a>
        </li>
        <li>
          <a href="#">414생활관</a>
        </li>
        <li>
          <a href="#">신앙상담</a>
        </li>
      </ul>
    </nav>

    <div class="user">
      <div class="user__login">
        <a href="/auth/login">로그인</a>
      </div>
      <div class="user__panel">
        <button class="user__info">MY</button>
        <ul class="user__layer">
          <li><a href="#">글 쓰기</a></li>
          <li><a href="#">나의 글</a></li>
          <li><a href="#">내 정보</a></li>
          <li><button>로그아웃</button></li>
        </ul>
      </div>
    </div>

    <button class="menu" @click="onMenu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
</header>
</template>

<script>
import gsap from 'gsap';
import { fromEvent } from 'rxjs';
import { map, distinctUntilChanged } from 'rxjs/operators';

export default {
  mounted() {

    const breakpoint = 800;
    const pageScroll$ = fromEvent(window, 'scroll');
    const pageResize$ = fromEvent(window, 'resize');

    this.header = document.querySelector('.header');
    this.gnb = this.header.querySelector('.gnb');

    // init
    window.innerWidth < breakpoint ? this.onFold() : this.onSpread();


    pageScroll$
    .pipe(
      map(() => {
        let isInvert = false;
        document.querySelectorAll('[data-invert]').forEach((element) => {

          const checkPoint = 80 / 2;  // header height

          const rect = element.getBoundingClientRect();
          if(rect.top < checkPoint && checkPoint < rect.height - Math.abs(rect.top)) {
            isInvert = true;
          }

        })

        console.log('invert scroll');

        return isInvert;
      }),
      distinctUntilChanged()
    )
    .subscribe(isInvert => {
      if(isInvert) {
        this.header.classList.add('is-invert');
      } else {
        this.header.classList.remove('is-invert');
      }
    });

    pageScroll$
    .pipe(
      map(() => {

        let offset = 0;

        if(document.querySelector('[data-cover]')) {
          offset = document.querySelector('[data-cover]').clientHeight / 2;
        }

        return (window.scrollY || window.pageYOffset) > offset ? true : false;
      }),
      distinctUntilChanged()
    )
    .subscribe((isHide) => {

      if(window.innerWidth < breakpoint) return;

      if(this.header.classList.contains('is-open')) return;

      if(isHide) {
        this.onFold();

      } else {

        this.onSpread();
      }
    });

    pageResize$
    .pipe(
      map(() => {
        return window.innerWidth < breakpoint ? true : false;
      }),
      distinctUntilChanged()
    )
    .subscribe(isMobile => {
      if(isMobile) {
        this.onFold();
      } else {
        this.onSpread();
      }
    });

    window.dispatchEvent(new CustomEvent('scroll'));
  },
  methods: {
    onMenu() {
      const header = document.querySelector('.header');
      if(header.classList.contains('is-open')) {
        header.classList.remove('is-open');
      } else {
        header.classList.add('is-open');
      }

      console.log('on Menu');
    },
    onSpread() {
      if(this.header.classList.contains('is-spread')) return;

      gsap.to('.menu', { duration: 0.3, x: '-30', autoAlpha: 0 });
      this.header.classList.add('is-spread');
      gsap.to(this.gnb, { duration: 0.3, delay: 0.13, x: '0', autoAlpha: 1, onComplete: () => {

      }});
    },
    onFold() {
      if(this.header.classList.contains('is-spread')) {
        gsap.to(this.gnb, { duration: 0.3, x: '65', autoAlpha: 0, onComplete: () => {

        }});
        gsap.to('.menu', { duration: 0.3, delay: 0.13, x: '0', autoAlpha: 1, onComplete: () => {
          this.header.classList.remove('is-spread');

        }});
      }
    }
  }
}
</script>

<style lang="css" scoped>
</style>
